### Лаб. 1

## Штирлиц

Исходное сообщение было в одной из кодировок (cp1221, cp866, koi8-r).

По пути к пользователю оно подверглось N преобразованиям из одной кодировки в другую (N in [0..3])

Задача - написать программу, восстанавливающую исходное сообщение.

- Надо как-то понимать, в какой кодировке текст (или он не в одной из кодировок)
- Надо уметь преобразовывать из кодировки в кодировку

## Мысли

> [14:49:20] Богданов Егор (15-ПМ): Здравствуйте. Хотелось бы задать несколько вопросов по лабараторке : Подразумевается что текст полностью на русском  или как?
> и насколько большой по объему может быть текст?
> Заранее спасибо

> [14:51:05] Dmitry Bondin: Полностью на русском - нет. Но все, что в диапазоне [0..127] не должно играть роли - ASCII оно везде ASCII.
> Соответственно при сборе статистики учитывать только символы в диапазоне [128..255]

> [14:51:54] Dmitry Bondin: По объему - давайте скажем так: 1 копия текста может быть целиком размещена в оперативной памяти.

> [14:52:23] Dmitry Bondin: Т.е. потенциально большой, две копии уже могут не влезть

> [14:52:49] Dmitry Bondin: Но вроде и не надо иметь много копий в памяти-то, на все есть временные файлы.

> [14:53:37] Богданов Егор (15-ПМ): Да, спасибо.

> [14:53:53] Dmitry Bondin: А вообще, по объему текста - оно вам не надо, не принципиально. У вас 2 задачи

> 1 - определить куда перекодировать

> 2 - перекодировать

> [14:54:46] Dmitry Bondin: Вторая задача не требует много памяти - прочитал символ исходного файла -> перекодировал -> записал в результирующий файл

> [14:58:47] Dmitry Bondin: Первая задача если немного поразмыслить - тоже не сильно требует памяти. Ведь чтоб собрать языковую статистику по тексту размером с большую российскую энциклопедию вам совсем-совсем не надо 100500 мегабайт памяти... Достаточно скажем первые 1024 не-ASCII буквы прочитать и на них строить всю статистику. На килобайте данных статистика будет плюс-минус такая-же как и на гигабайте... если текст осмысленный... а это мы предполагаем. Грубо - буква 'е' и там и там будет самая крутая : ) Так-что размер не имеет значения, давайте исходить из того, что он любой, и в память целиком не влезет.

## Мысли 2

> [21:56:08] Симаков Евгений (15-ПМ): По каким принципам происходит перевод из одной кодировки в другую? Очевидно, нельзя просто заменять коды символов, так как отпадет смысл в цепочке преобразований. Возможно, это осуществляется определенным смещением кодов символов, но тогда для каждой кодировки в каждую получается 6 алгоритмов и они все разные. Соответсвенно вопрос, в нужную ли сторону я копаю?

> [22:31:31] Dmitry Bondin: <<Очевидно, нельзя просто заменять коды символов>>
>   Именно что можно

> [22:32:47] Dmitry Bondin: Смещение - слишком сложно. Нужно 6 таблиц перевода из одной в другую, причем чем проще - тем быстрее/лучше
> [22:34:48] Dmitry Bondin: Я-бы сделал 6 массивов типа unsigned char koi8_to_cp1251[256] и делал как-нибудь типа:

> while() {
>   unsigned char in = read();
>   if error -> break;
>   write(koi8_to_cp1251[in]);
> }

> [22:35:07] Dmitry Bondin: Максимально быстро будет работать же.

> [22:36:02] Dmitry Bondin: А сами эти массивы - я-бы лично сгенерил вспомогательной программкой, чтоб так много руками не задавать

> [22:36:36] Симаков Евгений (15-ПМ): Да, читал про это пару статей. В этом случае принцип ясен.

> [22:36:38] Симаков Евгений (15-ПМ): спасибо

> [22:51:13] Симаков Евгений (15-ПМ): Тогда возникает вопрос, какой смысл в построении дерева, ведь переход из одной кодировки в другую транзитивен. Т.е. Если мы делаем преобразования: КОИ->1251->866  и КОИ->866, то получится одно и то же.

> [22:51:29] Симаков Евгений (15-ПМ): Либо лыжи не едут, либо я

> [22:56:12] Dmitry Bondin: Нет, не то.

> [22:57:47] Dmitry Bondin: Вся идея в том, что перекодировка идет потенциально неверная. Например был файл в koi8. Проходя через почтовый сервер он был перекодирован 1251->866 например - ну умный почтовый сервер.

> [22:57:58] Dmitry Bondin: И так до 3-х раз

> [22:59:33 | Edited 23:00:32] Dmitry Bondin: Что будет с файлом в koi8, на который сначала подвергли 1251->866, потом koi8->1251 и напоследок 866->koi8

> [22:59:44] Dmitry Bondin: Как его прочесть?

> [23:00:02] Dmitry Bondin: Вот наша программа и должна распутать это безобразие

> [23:00:14] Симаков Евгений (15-ПМ): да, я понял, вот теперь понял
